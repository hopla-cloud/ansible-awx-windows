---
- name: Get offlines volumes id
  win_shell: |
    $disks=(get-disk | Where-Object OperationalStatus -eq "Offline").SerialNumber
    write-host $disks
  register: vol_id

- name: Creation de la list des volumes attaches
  set_fact:
    search_filer: "{{ ansible_hostname|lower }}_filer"
    search_profiles: "{{ ansible_hostname|lower }}_profiles"
    vol_attach: "{{ hostvars['localhost'].volumes_list2 | dict2items | selectattr('key', 'match', ansible_hostname|lower) | list | items2dict }}"

- name: Rechercher des types de volumes
  set_fact:
    vol_filer: "{{ vol_attach | dict2items | selectattr('key', 'match', search_filer) | list }}"
    vol_profiles: "{{ vol_attach | dict2items | selectattr('key', 'match', search_profiles) | list | items2dict }}"

- name: Rechercher des types de volumes
  set_fact:
    vol_filer: "{{ vol_filer.value }}"
#    vol_profiles: "{{ vol_attach | dict2items | selectattr('key', 'match', search_profiles) | list | items2dict }}"

#- name: Mount all offlines volumes
#  win_shell: |
#    $off_disk=(Get-Disk | Where-Object OperationalStatus -eq "Offline")
#    if ($off_disk){
#    $off_disk | Set-Disk -IsOffline $False
#    $off_disk | Initialize-Disk -PartitionStyle GPT
#    $off_disk | New-Partition -UseMaximumSize -AssignDriveLetter | Format-Volume
#    Write-Host Change
#    }
#  register: ad_volumes_init
#  changed_when: ("Change" in ad_volumes_init.stdout)
